

<div class="w-full flex flex-col h-screen">
  <h1 class="font-bold text-4xl mb-4">Explore listings nearby</h1>
  
  <!-- Barra de búsqueda -->
  <%= form_with url: explore_path, class: "w-full mb-4", method: :get do |form| %>
    <div class="flex w-full gap-2 items-end">
      <div class="flex flex-col max-w-sm w-full">
        <%= form.label :location, class: "block mb-2 text-sm font-medium text-gray-900" %>
        <%= form.text_field :location,
             class: "bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",
            value: params[:location],
            placeholder: "Enter location..." %>
      </div>
      <%= form.submit "Search",
           class: "cursor-pointer text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3" %>
    </div>
  <% end %>
  
  <!-- Mapa con marcadores -->
  <div class="flex-1 bg-gray-100 rounded-lg overflow-hidden">
    <div id="map"
          class="w-full h-full"
          data-controller="map"
          data-map-x-value="<%= @map_x %>"
          data-map-y-value="<%= @map_y %>"
          data-map-center-lat-value="<%= @center_lat %>"
          data-map-center-lng-value="<%= @center_lng %>"
          data-map-data-value="<%= (@listing_data || @courses_data).to_json %>"
          data-map-courses-value="<%= @courses_data.to_json if defined?(@courses_data) %>">
    </div>
  </div>
  
  <!-- Resultados de búsqueda -->
  <% if @courses&.any? %>
    <div class="mt-4">
      <h2 class="text-xl font-semibold mb-2">Found <%= pluralize(@courses.count, 'course') %></h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <% @courses.each do |course| %>
          <div class="border rounded-lg p-4 bg-white shadow">
            <h3 class="font-bold text-lg">
              <%= link_to course.title, course, class: "text-blue-600 hover:text-blue-800" %>
            </h3>
            <p class="text-gray-600 text-sm mt-1"><%= course.location %></p>
            <p class="text-gray-800 mt-2">
              <%= truncate(strip_tags(course.description), length: 100) %>
            </p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>


<!-- app/views/explore/show.html.erb -->

<!-- Debug Info (remover en producción) -->
<div style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace;">
  <strong>Debug Info:</strong><br>
  Map X: <%= @map_x %><br>
  Map Y: <%= @map_y %><br>
  Center Lat: <%= @center_lat %><br>
  Center Lng: <%= @center_lng %><br>
  Courses Count: <%= @courses.count %><br>
  Course Data: <%= @listing_data.to_json if defined?(@listing_data) %><br>
  Courses Data: <%= @courses_data.to_json if defined?(@courses_data) %>
</div>